import java.sql.*;
import java.util.Scanner;

public class ToChange extends InfoMa {

    public static void main(String[] args) throws SQLException {
        Connection connection = Database.getConnection();
        Scanner scanner = new Scanner(System.in);

        System.out.print("Enter course name: ");
        courseName = scanner.nextLine();

        System.out.print("Enter student name: ");
        studentName = scanner.nextLine();


        boolean keepUpdating = true;
        while (keepUpdating) {

            System.out.println("What score do you want to update?");
            System.out.println("1. Homework");
            System.out.println("2. Assignment");
            System.out.println("3. Midterm");
            System.out.println("4. Endterm");
            int choice = scanner.nextInt();
            scanner.nextLine();


            String updateQuery = "";
            String columnToChange = "";
            switch (choice) {
                case 1:
                    updateQuery = "UPDATE enrollments SET homework_score = ? WHERE student_id = ? AND course_id = ?";
                    columnToChange = "homeworks";
                    break;
                case 2:
                    updateQuery = "UPDATE enrollments SET assignment_score = ? WHERE student_id = ? AND course_id = ?";
                    columnToChange = "assignments";
                    break;
                case 3:
                    updateQuery = "UPDATE enrollments SET midterm_score = ? WHERE student_id = ? AND course_id = ?";
                    columnToChange = "midterm";
                    break;
                case 4:
                    updateQuery = "UPDATE enrollments SET endterm_score = ? WHERE student_id = ? AND course_id = ?";
                    columnToChange = "endterm";
                    break;
                default:
                    System.out.println("Invalid choice.");
                    continue;
            }
            System.out.print("Enter new " + columnToChange + " score: ");
            int newScore = scanner.nextInt();
            PreparedStatement updateStatement = connection.prepareStatement(updateQuery);
            updateStatement.setInt(1, newScore);
            updateStatement.setInt(2, getStudentId(connection, studentName));
            updateStatement.setInt(3, getCourseId(connection, courseName));
            updateStatement.executeUpdate();
            System.out.println("Score updated successfully.");

            System.out.print("Do you want to update another score? (y/n) ");
            String answer = scanner.nextLine().toLowerCase();
            keepUpdating = answer.equals("y");
        }

        String selectQuery = "SELECT * FROM enrollments WHERE student_id = ? AND course_id = ?";
        PreparedStatement selectStatement = connection.prepareStatement(selectQuery);
        selectStatement.setInt(1, getStudentId(connection, studentName));
        selectStatement.setInt(2, getCourseId(connection, courseName));
        ResultSet resultSet = selectStatement.executeQuery();
        if (resultSet.next()) {
            midtermScore = resultSet.getInt("midterm_score");
            endtermScore = resultSet.getInt("endterm_score");
            homeworksScore = resultSet.getInt("homework_score");
            assignmentsScore = resultSet.getInt("assignment_score");
            totalScore = midtermScore + endtermScore + homeworksScore + assignmentsScore;
            gpa = totalScore / 100.0;
            System.out.println("Student information for course " + courseName + ":");
            System.out.println("Student name: " + studentName);
            System.out.println("Midterm score: " + midtermScore);
            System.out.println("Endterm score: " + endtermScore);
            System.out.println("Homeworks score: " + homeworksScore);
            System.out.println("Assignments score: " + assignmentsScore);
            System.out.println("GPA: " + gpa);


        } else {
            System.out.println("No records found for student " + studentName + " in course " + courseName + ".");
        }
    }


    @Override
    public String toString() {
        return "Changed scores for " +  super.toString();
    }

    @Override
    public String displayInfo() {
        System.out.println(studentName + "'s " + "gpa " + gpa);
        return null;
    }
}
